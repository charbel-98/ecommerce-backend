////////////////////////////////////////////////////
// Mini-Ecommerce Database Schema (DBML)
////////////////////////////////////////////////////

// GREEN — Core Entities
 users {
  id UUID [pk]
  email varchar [unique, not null]
  passwordHash varchar [not null]
  firstName varchar [not null]
  lastName varchar [not null]
  role userRole [not null, default: 'CUSTOMER']
  createdAt datetime [not null]
  updatedAt datetime [not null]
}

Enum userRole {
  CUSTOMER
  ADMIN
}

 refresh_tokens {
  id UUID [pk]
  token varchar [unique, not null]
  userId UUID [not null]
  expiresAt datetime [not null]
  createdAt datetime [not null]
  revokedAt datetime
}

////////////////////////////////////////////////////
// BLUE — Catalog & Variants
 products {
  id UUID pk
  name varchar [not null]
  description text
  basePrice int [not null] // in cents (smallest currency unit)
  status productStatus [not null, default: 'ACTIVE']
  createdAt datetime [not null]
  updatedAt datetime [not null]
}

Enum productStatus {
  ACTIVE
  INACTIVE
}

 product_variants {
  id UUID [pk]
  productId UUID fk
  sku varchar [unique, not null]
  attributes jsonb [not null] // e.g. {"size": "M", "color": "Red"}
  price int [not null] // in cents
  stock int [not null, default: 0]
  createdAt datetime [not null]
  updatedAt datetime [not null]
}

////////////////////////////////////////////////////
// ORANGE — Orders & Cart
 carts {
  id UUID [pk]
  userId UUID fk
  createdAt datetime [not null]
  updatedAt datetime [not null]
}

 cart_items {
  id UUID [pk]
  cartId UUID fk
  variantId UUID fk
  quantity int [not null, default: 1]
  createdAt datetime [not null]
  updatedAt datetime [not null]
}

 orders {
  id UUID [pk]
  userId UUID fk
  totalAmount int [not null] // sum in cents
  status orderStatus [not null, default: 'PENDING']
  createdAt datetime [not null]
  updatedAt datetime [not null]
}

Enum orderStatus {
  PENDING
  PAID
  SHIPPED
  COMPLETED
  CANCELLED
}

 order_items {
  id UUID [pk]
  orderId UUID fk
  variantId UUID fk
  quantity int [not null]
  unitPrice int [not null] // price in cents at purchase time
  createdAt datetime [not null]
  updatedAt datetime [not null]
}

////////////////////////////////////////////////////
// RED — Logs
 audit_logs {
  id UUID [pk]
  userId UUID fk
  action varchar [not null]
  entity varchar [not null] // e.g., 'Product', 'Order'
  entityId UUID
  metadata jsonb
  createdAt datetime [not null]
}

////////////////////////////////////////////////////
// RELATIONSHIPS
////////////////////////////////////////////////////

// Users → Carts, Orders, Logs, Refresh Tokens
 carts.userId > users.id
 orders.userId > users.id
 audit_logs.userId > users.id
 refresh_tokens.userId > users.id

// Products → Variants
 product_variants.productId > products.id

// Cart → Cart Items → Variants
 cart_items.cartId > carts.id
 cart_items.variantId > product_variants.id

// Orders → Order Items → Variants
 order_items.orderId > orders.id
 order_items.variantId > product_variants.id
